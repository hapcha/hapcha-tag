export class HapchaTag{constructor(){this.decode_map=[{flag:"v",type:"number",field:"version"},{flag:"N",type:"string",field:"product_name"},{flag:"n",type:"string",field:"generic_name"},{flag:"S",type:"number",field:"product_amount"},{flag:"s",type:"number",field:"serving_amount"},{flag:"U",type:"string",field:"unit"},{flag:"K",type:"number",field:"kcal_100g"},{flag:"P",type:"number",field:"proteins_100g"},{flag:"Cn",type:"number",field:"casein_100g"},{flag:"Sp",type:"number",field:"serum-proteins_100g"},{flag:"Nu",type:"number",field:"nucleotides_100g"},{flag:"C",type:"number",field:"carbohydrates_100g"},{flag:"Cs",type:"number",field:"sugars_100g"},{flag:"Su",type:"number",field:"sucrose_100g"},{flag:"Gl",type:"number",field:"glucose_100g"},{flag:"Fr",type:"number",field:"fructose_100g"},{flag:"La",type:"number",field:"lactose_100g"},{flag:"Ma",type:"number",field:"maltose_100g"},{flag:"Mx",type:"number",field:"maltodextrins_100g"},{flag:"St",type:"number",field:"starch_100g"},{flag:"Pl",type:"number",field:"polyols_100g"},{flag:"F",type:"number",field:"fat_100g"},{flag:"Fs",type:"number",field:"saturated-fat_100g"},{flag:"Bt",type:"number",field:"butyric-acid_100g"},{flag:"Cp",type:"number",field:"caproic-acid_100g"},{flag:"Cy",type:"number",field:"caprylic-acid_100g"},{flag:"Cc",type:"number",field:"capric-acid_100g"},{flag:"Lu",type:"number",field:"lauric-acid_100g"},{flag:"My",type:"number",field:"myristic-acid_100g"},{flag:"Pm",type:"number",field:"palmitic-acid_100g"},{flag:"Sr",type:"number",field:"stearic-acid_100g"},{flag:"Ar",type:"number",field:"arachidic-acid_100g"},{flag:"Bh",type:"number",field:"behenic-acid_100g"},{flag:"Lg",type:"number",field:"lignoceric-acid_100g"},{flag:"Ce",type:"number",field:"cerotic-acid_100g"},{flag:"Mt",type:"number",field:"montanic-acid_100g"},{flag:"Me",type:"number",field:"melissic-acid_100g"},{flag:"Fm",type:"number",field:"monounsaturated-fat_100g"},{flag:"Fp",type:"number",field:"polyunsaturated-fat_100g"},{flag:"Ot",type:"number",field:"omega-3-fat_100g"},{flag:"Al",type:"number",field:"alpha-linolenic-acid_100g"},{flag:"Ei",type:"number",field:"eicosapentaenoic-acid_100g"},{flag:"Dx",type:"number",field:"docosahexaenoic-acid_100g"},{flag:"Os",type:"number",field:"omega-6-fat_100g"},{flag:"Ll",type:"number",field:"linoleic-acid_100g"},{flag:"Ac",type:"number",field:"arachidonic-acid_100g"},{flag:"Ga",type:"number",field:"gamma-linolenic-acid_100g"},{flag:"Dg",type:"number",field:"dihomo-gamma-linolenic-acid_100g"},{flag:"On",type:"number",field:"omega-9-fat_100g"},{flag:"Ol",type:"number",field:"oleic-acid_100g"},{flag:"El",type:"number",field:"elaidic-acid_100g"},{flag:"Gd",type:"number",field:"gondoic-acid_100g"},{flag:"Md",type:"number",field:"mead-acid_100g"},{flag:"Er",type:"number",field:"erucic-acid_100g"},{flag:"Ne",type:"number",field:"nervonic-acid_100g"},{flag:"Ft",type:"number",field:"trans-fat_100g"},{flag:"Ch",type:"number",field:"cholesterol_100g"},{flag:"Fi",type:"number",field:"fiber_100g"},{flag:"Na",type:"number",field:"sodium_100g"},{flag:"A",type:"number",field:"alcohol_100g"},{flag:"Av",type:"number",field:"vitamin-a_100g"},{flag:"Dv",type:"number",field:"vitamin-d_100g"},{flag:"Ev",type:"number",field:"vitamin-e_100g"},{flag:"Kv",type:"number",field:"vitamin-k_100g"},{flag:"Cv",type:"number",field:"vitamin-c_100g"},{flag:"Bo",type:"number",field:"vitamin-b1_100g"},{flag:"Br",type:"number",field:"vitamin-b2_100g"},{flag:"Pp",type:"number",field:"vitamin-pp_100g"},{flag:"Bs ",type:"number",field:"vitamin-b6_100g"},{flag:"Bn",type:"number",field:"vitamin-b9_100g"},{flag:"Bw",type:"number",field:"vitamin-b12_100g"},{flag:"Bi",type:"number",field:"biotin_100g"},{flag:"Pa",type:"number",field:"pantothenic-acid_100g"},{flag:"Si ",type:"number",field:"silica_100g"},{flag:"Bc",type:"number",field:"bicarbonate_100g"},{flag:"Kp ",type:"number",field:"potassium_100g"},{flag:"Cl",type:"number",field:"chloride_100g"},{flag:"Ca",type:"number",field:"calcium_100g"},{flag:"Ps",type:"number",field:"phosphorus_100g"},{flag:"Fe",type:"number",field:"iron_100g"},{flag:"Mg ",type:"number",field:"magnesium_100g"},{flag:"Zn",type:"number",field:"zinc_100g"},{flag:"Cu",type:"number",field:"copper_100g"},{flag:"Mn",type:"number",field:"manganese_100g"},{flag:"Fl",type:"number",field:"fluoride_100g"},{flag:"Se",type:"number",field:"selenium_100g"},{flag:"Cr",type:"number",field:"chromium_100g"},{flag:"Mo",type:"number",field:"molybdenum_100g"},{flag:"Io",type:"number",field:"iodine_100g"},{flag:"Cf",type:"number",field:"caffeine_100g"},{flag:"Ta",type:"number",field:"taurine_100g"},{flag:"Ph",type:"number",field:"ph_100g"},{flag:"Fv ",type:"number",field:"fruits-vegetables-nuts_100g"},{flag:"Cb ",type:"number",field:"carbon-footprint_100g"},{flag:"Nf ",type:"number",field:"nutrition-score-fr_100g"},{flag:"Nk ",type:"number",field:"nutrition-score-uk_100g"},{flag:"Pc",type:"bool",field:"contains_pecans"},{flag:"Mu",type:"bool",field:"contains_mustard"},{flag:"Wa",type:"bool",field:"contains_walnuts"},{flag:"Mc",type:"bool",field:"contains_macadamia-nuts"},{flag:"Ci",type:"bool",field:"contains_caffeine"},{flag:"Pe",type:"bool",field:"contains_peanuts"},{flag:"Sy",type:"bool",field:"contains_soya"},{flag:"Gt",type:"bool",field:"contains_gluten"},{flag:"Am",type:"bool",field:"contains_almonds"},{flag:"Cg",type:"bool",field:"contains_celery"},{flag:"Sx",type:"bool",field:"contains_sulphur-dioxide"},{flag:"Pi",type:"bool",field:"contains_pistachios"},{flag:"Cw",type:"bool",field:"contains_cashew-nuts"},{flag:"Hz",type:"bool",field:"contains_hazelnuts"},{flag:"So",type:"bool",field:"contains_soy"},{flag:"Bz",type:"bool",field:"contains_brazil-nuts"},{flag:"Mk",type:"bool",field:"contains_milk"},{flag:"Sh",type:"bool",field:"contains_sulphites"},{flag:"Pn",type:"bool",field:"contains_pine-nuts"},{flag:"Ss",type:"bool",field:"contains_sesame"}]}_validURL(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}decode(e){this._validURL(e)&&(e=(e=decodeURI(e)).split("?ht=")[1]);const i="["==e[0]?e.split("[").join("").split("]").slice(0,-1):[e],l=this.decode_map.map(e=>e.flag);return i.map(e=>{let i=0;const a={};for(;i<e.length;){const t=e[i+1],n=isNaN(t)&&'"'!=t?2:1,f=e.substring(i,i+n);if('"'!=f[0]&&isNaN(f[0]))if(l.indexOf(f)>=0){const t=this.decode_map[l.indexOf(f)];if("number"==t.type){const l=i+f.length;let n=e.substring(l).search(/[A-Za-z]/)>=0?e.substring(l).search(/[A-Za-z]/)+l:e.length;const g=e.substring(l,n);a[t.field]=parseFloat(g),i=n}else if("bool"==t.type){const l=i+f.length;let n=e.substring(l).search(/[A-Za-z]/)>=0?e.substring(l).search(/[A-Za-z]/)+l:e.length;const g=e.substring(l,n),d=1==parseInt(g);a[t.field]=d,i=n}else if("string"==t.type){const l=i+f.length+1,n=e.substring(l).indexOf('"')+l,g=n-l;a[t.field]=e.substr(l,g),i=n+1}else console.warn("A variable of unknown type ("+t.type+") was recieved for decoding."),i+=1}else i+=f.length;else i+=1}return a})}encode(e,i={domain:!1}){const l=e instanceof Array?e:[e],a=this.decode_map.map(e=>e.field);let t=l.map(e=>{let i="v1";return Object.keys(e).map(l=>{if(a.indexOf(l)>=0&&"version"!=l){const t=this.decode_map[a.indexOf(l)].flag;let n;if("string"==this.decode_map[a.indexOf(l)].type)n='"'+e[l]+'"';else if("bool"==this.decode_map[a.indexOf(l)].type)n=e[l]?"1":"0";else{if("number"!=this.decode_map[a.indexOf(l)].type)throw new Error("An input variable of unknown type ("+this.decode_map[a.indexOf(l)].type+") was sent for encoding.");n=e[l]}i+=t+n}}),i});if(t.length>1&&(t=(t=t.map(e=>"["+e+"]")).join("")),0==i.domain)return t;return i.domain+"?ht="+t}}