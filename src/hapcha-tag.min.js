export class HapchaTag{constructor(){this.decode_map=[{flag:"v",type:"number",field:"version"},{flag:"N",type:"string",field:"product_name"},{flag:"n",type:"string",field:"generic_name"},{flag:"S",type:"number",field:"product_amount"},{flag:"s",type:"number",field:"serving_amount"},{flag:"i",type:"collection",field:"ingredients"},{flag:"U",type:"string",field:"unit"},{flag:"K",type:"number",field:"energy-kcal_100g"},{flag:"P",type:"number",field:"proteins_100g"},{flag:"Cn",type:"number",field:"casein_100g"},{flag:"Sp",type:"number",field:"serum-proteins_100g"},{flag:"Nu",type:"number",field:"nucleotides_100g"},{flag:"C",type:"number",field:"carbohydrates_100g"},{flag:"Cs",type:"number",field:"sugars_100g"},{flag:"Su",type:"number",field:"sucrose_100g"},{flag:"Gl",type:"number",field:"glucose_100g"},{flag:"Fr",type:"number",field:"fructose_100g"},{flag:"La",type:"number",field:"lactose_100g"},{flag:"Ma",type:"number",field:"maltose_100g"},{flag:"Mx",type:"number",field:"maltodextrins_100g"},{flag:"St",type:"number",field:"starch_100g"},{flag:"Pl",type:"number",field:"polyols_100g"},{flag:"F",type:"number",field:"fat_100g"},{flag:"Fs",type:"number",field:"saturated-fat_100g"},{flag:"Bt",type:"number",field:"butyric-acid_100g"},{flag:"Cp",type:"number",field:"caproic-acid_100g"},{flag:"Cy",type:"number",field:"caprylic-acid_100g"},{flag:"Cc",type:"number",field:"capric-acid_100g"},{flag:"Lu",type:"number",field:"lauric-acid_100g"},{flag:"My",type:"number",field:"myristic-acid_100g"},{flag:"Pm",type:"number",field:"palmitic-acid_100g"},{flag:"Sr",type:"number",field:"stearic-acid_100g"},{flag:"Ar",type:"number",field:"arachidic-acid_100g"},{flag:"Bh",type:"number",field:"behenic-acid_100g"},{flag:"Lg",type:"number",field:"lignoceric-acid_100g"},{flag:"Ce",type:"number",field:"cerotic-acid_100g"},{flag:"Mt",type:"number",field:"montanic-acid_100g"},{flag:"Me",type:"number",field:"melissic-acid_100g"},{flag:"Fm",type:"number",field:"monounsaturated-fat_100g"},{flag:"Fp",type:"number",field:"polyunsaturated-fat_100g"},{flag:"Ot",type:"number",field:"omega-3-fat_100g"},{flag:"Al",type:"number",field:"alpha-linolenic-acid_100g"},{flag:"Ei",type:"number",field:"eicosapentaenoic-acid_100g"},{flag:"Dx",type:"number",field:"docosahexaenoic-acid_100g"},{flag:"Os",type:"number",field:"omega-6-fat_100g"},{flag:"Ll",type:"number",field:"linoleic-acid_100g"},{flag:"Ac",type:"number",field:"arachidonic-acid_100g"},{flag:"Ga",type:"number",field:"gamma-linolenic-acid_100g"},{flag:"Dg",type:"number",field:"dihomo-gamma-linolenic-acid_100g"},{flag:"On",type:"number",field:"omega-9-fat_100g"},{flag:"Ol",type:"number",field:"oleic-acid_100g"},{flag:"El",type:"number",field:"elaidic-acid_100g"},{flag:"Gd",type:"number",field:"gondoic-acid_100g"},{flag:"Md",type:"number",field:"mead-acid_100g"},{flag:"Er",type:"number",field:"erucic-acid_100g"},{flag:"Ne",type:"number",field:"nervonic-acid_100g"},{flag:"Ft",type:"number",field:"trans-fat_100g"},{flag:"Ch",type:"number",field:"cholesterol_100g"},{flag:"Fi",type:"number",field:"fiber_100g"},{flag:"Na",type:"number",field:"sodium_100g"},{flag:"A",type:"number",field:"alcohol_100g"},{flag:"Av",type:"number",field:"vitamin-a_100g"},{flag:"Dv",type:"number",field:"vitamin-d_100g"},{flag:"Ev",type:"number",field:"vitamin-e_100g"},{flag:"Kv",type:"number",field:"vitamin-k_100g"},{flag:"Cv",type:"number",field:"vitamin-c_100g"},{flag:"Bo",type:"number",field:"vitamin-b1_100g"},{flag:"Br",type:"number",field:"vitamin-b2_100g"},{flag:"Pp",type:"number",field:"vitamin-pp_100g"},{flag:"Bs ",type:"number",field:"vitamin-b6_100g"},{flag:"Bn",type:"number",field:"vitamin-b9_100g"},{flag:"Bw",type:"number",field:"vitamin-b12_100g"},{flag:"Bi",type:"number",field:"biotin_100g"},{flag:"Pa",type:"number",field:"pantothenic-acid_100g"},{flag:"Si ",type:"number",field:"silica_100g"},{flag:"Bc",type:"number",field:"bicarbonate_100g"},{flag:"Kp",type:"number",field:"potassium_100g"},{flag:"Cl",type:"number",field:"chloride_100g"},{flag:"Ca",type:"number",field:"calcium_100g"},{flag:"Ps",type:"number",field:"phosphorus_100g"},{flag:"Fe",type:"number",field:"iron_100g"},{flag:"Mg ",type:"number",field:"magnesium_100g"},{flag:"Zn",type:"number",field:"zinc_100g"},{flag:"Cu",type:"number",field:"copper_100g"},{flag:"Mn",type:"number",field:"manganese_100g"},{flag:"Fl",type:"number",field:"fluoride_100g"},{flag:"Se",type:"number",field:"selenium_100g"},{flag:"Cr",type:"number",field:"chromium_100g"},{flag:"Mo",type:"number",field:"molybdenum_100g"},{flag:"Io",type:"number",field:"iodine_100g"},{flag:"Cf",type:"number",field:"caffeine_100g"},{flag:"Ta",type:"number",field:"taurine_100g"},{flag:"Ph",type:"number",field:"ph_100g"},{flag:"Fv ",type:"number",field:"fruits-vegetables-nuts_100g"},{flag:"Cb ",type:"number",field:"carbon-footprint_100g"},{flag:"Nf ",type:"number",field:"nutrition-score-fr_100g"},{flag:"Nk ",type:"number",field:"nutrition-score-uk_100g"},{flag:"Pc",type:"bool",field:"contains_pecans"},{flag:"Mu",type:"bool",field:"contains_mustard"},{flag:"Wa",type:"bool",field:"contains_walnuts"},{flag:"Mc",type:"bool",field:"contains_macadamia-nuts"},{flag:"Ci",type:"bool",field:"contains_caffeine"},{flag:"Pe",type:"bool",field:"contains_peanuts"},{flag:"Sy",type:"bool",field:"contains_soya"},{flag:"Gt",type:"bool",field:"contains_gluten"},{flag:"Am",type:"bool",field:"contains_almonds"},{flag:"Cg",type:"bool",field:"contains_celery"},{flag:"Sx",type:"bool",field:"contains_sulphur-dioxide"},{flag:"Pi",type:"bool",field:"contains_pistachios"},{flag:"Cw",type:"bool",field:"contains_cashew-nuts"},{flag:"Hz",type:"bool",field:"contains_hazelnuts"},{flag:"So",type:"bool",field:"contains_soy"},{flag:"Bz",type:"bool",field:"contains_brazil-nuts"},{flag:"Mk",type:"bool",field:"contains_milk"},{flag:"Sh",type:"bool",field:"contains_sulphites"},{flag:"Pn",type:"bool",field:"contains_pine-nuts"},{flag:"Ss",type:"bool",field:"contains_sesame"}]}_validURL(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}decode(e,i={check_for_domain:!0,decimal_places:0}){i.check_for_domain&&this._validURL(e)&&(e=(e=decodeURI(e)).split("?ht=")[1]);const l="["==e[0]?e.split("[").join("").split("]").slice(0,-1):[e],a=this.decode_map.map((e=>e.flag));let t=l.map((e=>{let l=0;const t={};for(;l<e.length;){const n=e[l+1],f=(isNaN(n),1),g=e.substring(l,l+f);if('"'!=g[0]&&isNaN(g[0]))if(a.indexOf(g)>=0){const n=this.decode_map[a.indexOf(g)];if("number"==n.type){const a=l+g.length;let f=e.substring(a).search(/[A-Za-z]/)>=0?e.substring(a).search(/[A-Za-z]/)+a:e.length;const d=e.substring(a,f);t[n.field]=parseFloat(d).toFixed(i.decimal_places),l=f}else if("bool"==n.type){const i=l+g.length;let a=e.substring(i).search(/[A-Za-z]/)>=0?e.substring(i).search(/[A-Za-z]/)+i:e.length;const f=e.substring(i,a),d=1==parseInt(f);t[n.field]=d,l=a}else if("string"==n.type){const i=l+g.length+1,a=e.substring(i).indexOf('"')+i,f=a-i;t[n.field]=e.substr(i,f),l=a+1}else if("collection"==n.type){const i=l+g.length+1,a=e.split("").map(((e,i)=>e.indexOf("]")>=0?i:-1)).filter((l=>l>-1&l>i&("["!=e[l+1]||l+1==e.length)))[0],f=e.substring(i-1,a+1);t[n.field]=this.decode(f,{check_for_domain:!1}),l=a+1}else console.warn("A variable of unknown type ("+n.type+") was recieved for decoding."),l+=1}else l+=g.length;else l+=1}return t}));return 1==t.length&&(t=t[0]),t}encode(e,i={domain:!1,decimal_places:0}){const l=e instanceof Array?e:[e],a=this.decode_map.map((e=>e.field));let t=l.map((e=>{let l="v1";return Object.keys(e).map((t=>{if(a.indexOf(t)>=0&&"version"!=t){const n=this.decode_map[a.indexOf(t)].flag;let f;if("string"==this.decode_map[a.indexOf(t)].type)f=""!=e[t]?'"'+e[t]+'"':"";else if("bool"==this.decode_map[a.indexOf(t)].type)f=e[t]?"1":"0";else if("number"==this.decode_map[a.indexOf(t)].type)f=e[t].toFixed(i.decimal_places);else{if("collection"!=this.decode_map[a.indexOf(t)].type)throw new Error("An input variable of unknown type ("+this.decode_map[a.indexOf(t)].type+") was sent for encoding.");f=this.encode(e[t])}""!=String(f)&&(l+=n+f)}})),l}));if(t.length>1?(t=t.map((e=>"["+e+"]")),t=t.join("")):t=t[0],0==i.domain)return t;{const e=i.domain+"?ht="+t;return encodeURI(e)}}addCustomFlag(e){if("flag"in e&&"field"in e&&"type"in e){-1==this.decode_map.map((e=>e.flag)).indexOf(e.flag)?this.decode_map.push(e):console.warn("The custom flag ("+e.flag+") you tried to add already exists. Try another two letter identifier.")}}}